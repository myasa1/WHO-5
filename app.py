import streamlit as st
import numpy as np
from sklearn.linear_model import LogisticRegression

# ----------------------------
# 1ï¸âƒ£ ØªØ¯Ø±ÙŠØ¨ Ù†Ù…ÙˆØ°Ø¬ ØªÙ†Ø¨Ø¤ Ø¨Ø³ÙŠØ·
# ----------------------------
@st.cache_data
def generate_and_train_model():
    np.random.seed(42)
    num_users = 1000

    Q = np.random.randint(0, 6, (num_users, 5))
    SleepHours = np.random.randint(4, 11, num_users)
    ActivityLevel = np.random.randint(1, 6, num_users)

    TotalScore = Q.sum(axis=1)
    HighRisk = (TotalScore <= 12).astype(int)

    X = np.column_stack((Q, SleepHours, ActivityLevel))
    y = HighRisk

    model = LogisticRegression()
    model.fit(X, y)

    return model

model = generate_and_train_model()

# ----------------------------
# 2ï¸âƒ£ Ø¯Ø§Ù„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø°ÙƒÙŠØ©
# ----------------------------
def generate_plan(q1, q2, q3, q4, q5, sleep, activity, probability):

    plan = "## ğŸ“… Ø®Ø·ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© Ù„Ù…Ø¯Ø© 6 Ø£Ø³Ø§Ø¨ÙŠØ¹\n\n"

    total = q1 + q2 + q3 + q4 + q5

    # ØªÙ‚ÙŠÙŠÙ… Ø¹Ø§Ù…
    if total <= 12:
        plan += "ğŸ”´ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø±ÙØ§Ù‡ÙŠØ© Ù…Ù†Ø®ÙØ¶ Ø­Ø§Ù„ÙŠØ§Ù‹. Ø³Ù†Ø¨Ø¯Ø£ Ø¨Ø®Ø·Ø© Ø¯Ø¹Ù… Ù…ÙƒØ«ÙØ©.\n\n"
    elif total <= 18:
        plan += "ğŸŸ¡ Ù…Ø³ØªÙˆÙ‰ Ù…ØªÙˆØ³Ø·. Ù†Ø±ÙƒØ² Ø¹Ù„Ù‰ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ø£Ø¶Ø¹Ù.\n\n"
    else:
        plan += "ğŸŸ¢ Ù…Ø³ØªÙˆÙ‰ Ø¬ÙŠØ¯. Ø³Ù†Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø± ÙˆØ§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±.\n\n"

    # Ø§Ù„Ù†ÙˆÙ…
    if sleep < 6:
        plan += "### ğŸ’¤ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù†ÙˆÙ…\n"
        plan += "- ØªØ«Ø¨ÙŠØª Ù…ÙˆØ¹Ø¯ Ù†ÙˆÙ… ÙŠÙˆÙ…ÙŠ\n"
        plan += "- Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ… Ø¨Ø³Ø§Ø¹Ø©\n"
        plan += "- ØªÙ…Ø§Ø±ÙŠÙ† ØªÙ†ÙØ³ 4-7-8 ÙŠÙˆÙ…ÙŠØ§Ù‹\n\n"

    # Ø§Ù„Ù†Ø´Ø§Ø·
    if activity <= 2:
        plan += "### ğŸš¶â€â™‚ï¸ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ø´Ø§Ø·\n"
        plan += "- Ù…Ø´ÙŠ 20 Ø¯Ù‚ÙŠÙ‚Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹\n"
        plan += "- ØªÙ…Ø§Ø±ÙŠÙ† ØªÙ…Ø¯Ø¯ ØµØ¨Ø§Ø­ÙŠØ© 5 Ø¯Ù‚Ø§Ø¦Ù‚\n\n"

    # Ø§Ù„Ù…Ø²Ø§Ø¬
    if q1 <= 2:
        plan += "### ğŸ˜Š ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø²Ø§Ø¬\n"
        plan += "- ÙƒØªØ§Ø¨Ø© 3 Ø£Ø´ÙŠØ§Ø¡ Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© ÙŠÙˆÙ…ÙŠØ§Ù‹\n"
        plan += "- Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø´Ø®Øµ Ø¯Ø§Ø¹Ù… Ù…Ø±ØªÙŠÙ† Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹\n\n"

    # Ø§Ù„Ø·Ø§Ù‚Ø©
    if q3 <= 2:
        plan += "### âš¡ Ø±ÙØ¹ Ø§Ù„Ø·Ø§Ù‚Ø©\n"
        plan += "- Ø§Ù„ØªØ¹Ø±Ø¶ Ù„Ø¶ÙˆØ¡ Ø§Ù„Ø´Ù…Ø³ ØµØ¨Ø§Ø­Ø§Ù‹\n"
        plan += "- ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ù‡Ø§Ù… Ø¥Ù„Ù‰ Ø£Ø¬Ø²Ø§Ø¡ ØµØºÙŠØ±Ø©\n\n"

    # Ø§Ù„Ù…Ø¹Ù†Ù‰
    if q5 <= 2:
        plan += "### ğŸ¯ ØªØ¹Ø²ÙŠØ² Ø§Ù„Ù…Ø¹Ù†Ù‰\n"
        plan += "- ØªØ­Ø¯ÙŠØ¯ Ù‡Ø¯Ù ØµØºÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ\n"
        plan += "- Ù…Ù…Ø§Ø±Ø³Ø© Ø¹Ù…Ù„ ØªØ·ÙˆØ¹ÙŠ Ø¨Ø³ÙŠØ·\n\n"

    # Ø®Ø·Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©
    plan += "### ğŸ“† Ø§Ù„ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ\n"
    plan += """
Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1-2:
- ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ù†ÙˆÙ…
- Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø´ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ

Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 3-4:
- ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ
- ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©

Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 5:
- Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø´Ø®ØµÙŠØ©

Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 6:
- ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªÙ‚Ø¯Ù…
"""

    return plan


# ----------------------------
# 3ï¸âƒ£ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
# ----------------------------
st.title("ğŸ§  ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø±ÙØ§Ù‡ÙŠØ© Ø§Ù„Ù†ÙØ³ÙŠØ© WHO-5")
st.markdown("Ø£Ø¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙ‚Ø±ÙŠØ± ÙˆØ®Ø·Ø© ØªØ­Ø³ÙŠÙ† Ø´Ø®ØµÙŠØ©")

q1 = st.slider("1ï¸âƒ£ Ø´Ø¹Ø±Øª Ø¨Ù…Ø²Ø§Ø¬ Ø¬ÙŠØ¯", 0, 5, 2)
q2 = st.slider("2ï¸âƒ£ Ø´Ø¹Ø±Øª Ø¨Ø§Ù„Ù‡Ø¯ÙˆØ¡ ÙˆØ§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡", 0, 5, 2)
q3 = st.slider("3ï¸âƒ£ Ø´Ø¹Ø±Øª Ø¨Ø§Ù„Ù†Ø´Ø§Ø· ÙˆØ§Ù„Ø­ÙŠÙˆÙŠØ©", 0, 5, 2)
q4 = st.slider("4ï¸âƒ£ Ø§Ø³ØªÙŠÙ‚Ø¸Øª Ù†Ø´ÙŠØ·Ø§Ù‹ ÙˆÙ…Ù†ØªØ¹Ø´Ø§Ù‹", 0, 5, 2)
q5 = st.slider("5ï¸âƒ£ ÙƒØ§Ù† Ù„Ø­ÙŠØ§ØªÙŠ Ù…Ø¹Ù†Ù‰", 0, 5, 2)

sleep = st.slider("Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†ÙˆÙ… ÙŠÙˆÙ…ÙŠØ§Ù‹", 4, 10, 7)
activity = st.slider("Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¨Ø¯Ù†ÙŠ (1 Ù…Ù†Ø®ÙØ¶ - 5 Ø¹Ø§Ù„ÙŠ)", 1, 5, 3)

# ----------------------------
# 4ï¸âƒ£ Ø²Ø± Ø§Ù„ØªÙ†ÙÙŠØ°
# ----------------------------
if st.button("Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ ØªÙ‚Ø±ÙŠØ±ÙŠ ÙˆØ®Ø·ØªÙŠ"):

    user_input = np.array([[q1, q2, q3, q4, q5, sleep, activity]])
    probability = model.predict_proba(user_input)[0][1]

    total_score = q1 + q2 + q3 + q4 + q5

    st.markdown("### ğŸ“Š Ù†ØªØ§Ø¦Ø¬ ØªÙ‚ÙŠÙŠÙ…Ùƒ")
    st.write(f"Ù…Ø¬Ù…ÙˆØ¹ WHO-5: {total_score} Ù…Ù† 25")
    st.write(f"Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ø±ÙØ§Ù‡ÙŠØ©: {probability*100:.1f}%")

    if probability > 0.75:
        st.warning("âš ï¸ ÙŠÙÙØ¶Ù„ Ø§Ø³ØªØ´Ø§Ø±Ø© Ù…Ø®ØªØµ Ù†ÙØ³ÙŠ.")
    else:
        st.success("Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¶Ù…Ù† Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹.")

    st.info("Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø£Ø¯Ø§Ø© Ø¯Ø§Ø¹Ù…Ø© ÙÙ‚Ø· ÙˆÙ„Ø§ ÙŠÙØ¹Ø¯ ØªØ´Ø®ÙŠØµØ§Ù‹ Ø·Ø¨ÙŠØ§Ù‹.")

    plan = generate_plan(q1, q2, q3, q4, q5, sleep, activity, probability)

    st.markdown(plan)
