import streamlit as st
import numpy as np
from sklearn.ensemble import RandomForestClassifier

# =====================================
# ØªØ¯Ø±ÙŠØ¨ Ù†Ù…ÙˆØ°Ø¬ ØªØ¹Ù„Ù… Ø¢Ù„Ø©
# =====================================

@st.cache_data
def train_model():
    np.random.seed(42)
    n = 3000

    Q = np.random.randint(0, 6, (n, 5))
    sleep = np.random.randint(4, 11, n)
    activity = np.random.randint(1, 6, n)

    total = Q.sum(axis=1)

    risk = []
    for t in total:
        if t <= 10:
            risk.append(2)
        elif t <= 17:
            risk.append(1)
        else:
            risk.append(0)

    X = np.column_stack((Q, sleep, activity))
    y = np.array(risk)

    model = RandomForestClassifier(n_estimators=250, random_state=42)
    model.fit(X, y)

    return model

model = train_model()

# =====================================
# Ù…Ø­Ø±Ùƒ Ø§Ù„ØªØ­Ù„ÙŠÙ„ + Ø®Ø·Ø© ÙƒØ§Ù…Ù„Ø©
# =====================================

def generate_plan(q1, q2, q3, q4, q5, sleep, activity):

    scores = np.array([q1, q2, q3, q4, q5])
    labels = ["Ø§Ù„Ù…Ø²Ø§Ø¬", "Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡", "Ø§Ù„Ø·Ø§Ù‚Ø©", "Ø§Ù„Ù†ÙˆÙ… Ø§Ù„Ù…Ù†ØªØ¹Ø´", "Ø§Ù„Ù…Ø¹Ù†Ù‰"]

    total = scores.sum()
    low_count = np.sum(scores <= 2)
    imbalance = np.std(scores)

    bio_strain = 0
    if sleep <= 5:
        bio_strain += 1
    if q3 <= 2:
        bio_strain += 1
    if activity <= 2:
        bio_strain += 1

    # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù…Ø·
    if bio_strain >= 2:
        profile = "Ø§Ø³ØªÙ†Ø²Ø§Ù Ø¬Ø³Ø¯ÙŠ"
    elif low_count >= 3:
        profile = "Ø§Ù†Ø®ÙØ§Ø¶ Ù†ÙØ³ÙŠ Ø´Ø§Ù…Ù„"
    elif imbalance >= 1.5:
        profile = "Ø§Ø®ØªÙ„Ø§Ù„ ØºÙŠØ± Ù…ØªÙˆØ§Ø²Ù†"
    elif q5 <= 2:
        profile = "Ø¶Ø¹Ù ÙÙŠ Ø§Ù„Ù…Ø¹Ù†Ù‰"
    elif q1 <= 2:
        profile = "Ø§Ù†Ø®ÙØ§Ø¶ Ù…Ø²Ø§Ø¬ÙŠ"
    else:
        profile = "Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ù†Ø³Ø¨ÙŠ"

    report = "## ğŸ“‹ Ø§Ù„Ø®Ø·Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ†ÙŠØ© Ø§Ù„Ù…ÙØµÙ„Ø© Ù„Ù…Ø¯Ø© 6 Ø£Ø³Ø§Ø¨ÙŠØ¹\n\n"

    # =========================
    # 1ï¸âƒ£ Ø§Ø³ØªÙ†Ø²Ø§Ù Ø¬Ø³Ø¯ÙŠ
    # =========================
    if profile == "Ø§Ø³ØªÙ†Ø²Ø§Ù Ø¬Ø³Ø¯ÙŠ":
        report += """
### ğŸ’¤ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1-2: Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù†ÙˆÙ…
- ØªØ«Ø¨ÙŠØª Ù…ÙˆØ¹Ø¯ Ù†ÙˆÙ… ÙˆØ§Ø³ØªÙŠÙ‚Ø§Ø¸ ÙŠÙˆÙ…ÙŠ Ø­ØªÙ‰ ÙÙŠ Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹.
- Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ… Ø¨Ø³Ø§Ø¹Ø©.
- ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ÙƒØ§ÙÙŠÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© 4 Ù…Ø³Ø§Ø¡Ù‹.
- Ø´Ø±Ø¨ ÙƒÙ…ÙŠØ© ÙƒØ§ÙÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø§Ø¡ ÙŠÙˆÙ…ÙŠØ§Ù‹.

### ğŸŒ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 3-4: Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø·Ø§Ù‚Ø©
- Ø§Ù„Ù…Ø´ÙŠ 30 Ø¯Ù‚ÙŠÙ‚Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹.
- Ø§Ù„ØªØ¹Ø±Ø¶ Ù„Ø¶ÙˆØ¡ Ø§Ù„Ø´Ù…Ø³ ØµØ¨Ø§Ø­Ø§Ù‹.
- ØªÙ†Ø§ÙˆÙ„ ÙˆØ¬Ø¨Ø§Øª Ù…Ù†ØªØ¸Ù…Ø© Ù…ØªÙˆØ§Ø²Ù†Ø©.
- ØªÙ…Ø§Ø±ÙŠÙ† ØªÙ†ÙØ³ Ø¹Ù…ÙŠÙ‚ 5 Ø¯Ù‚Ø§Ø¦Ù‚ ÙŠÙˆÙ…ÙŠØ§Ù‹.

### ğŸ’ª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 5-6: Ø¨Ù†Ø§Ø¡ Ù‚ÙˆØ© ØªØ¯Ø±ÙŠØ¬ÙŠØ©
- Ø¥Ø¯Ø®Ø§Ù„ ØªÙ…Ø§Ø±ÙŠÙ† Ù…Ù‚Ø§ÙˆÙ…Ø© Ø®ÙÙŠÙØ© Ù…Ø±ØªÙŠÙ† Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹.
- Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø·Ø§Ù‚Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹.
- ØªØ­Ø¯ÙŠØ¯ Ù‡Ø¯Ù Ø¨Ø¯Ù†ÙŠ Ø¨Ø³ÙŠØ· ÙˆØªØ­Ù‚ÙŠÙ‚Ù‡.
"""

    # =========================
    # 2ï¸âƒ£ Ø§Ù†Ø®ÙØ§Ø¶ Ù†ÙØ³ÙŠ Ø´Ø§Ù…Ù„
    # =========================
    elif profile == "Ø§Ù†Ø®ÙØ§Ø¶ Ù†ÙØ³ÙŠ Ø´Ø§Ù…Ù„":
        report += """
### ğŸ§© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1: Ø§Ù„ØªØ«Ø¨ÙŠØª
- ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ù†ÙˆÙ… Ø£ÙˆÙ„Ø§Ù‹.
- ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø²Ù„Ø© ÙˆÙ„Ùˆ Ø¨Ù…Ø­Ø§Ø¯Ø«Ø© Ù‚ØµÙŠØ±Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹.
- ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ø´Ø§Ø¹Ø± ÙŠÙˆÙ…ÙŠØ§Ù‹ Ù„Ù…Ø¯Ø© 5 Ø¯Ù‚Ø§Ø¦Ù‚.

### ğŸŒ¤ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 2-3: ØªÙ†Ø´ÙŠØ· Ø³Ù„ÙˆÙƒÙŠ
- ØªØ­Ø¯ÙŠØ¯ Ù†Ø´Ø§Ø· Ù…Ù…ØªØ¹ Ù…Ø±ØªÙŠÙ† Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹.
- ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ø¥Ù„Ù‰ Ø®Ø·ÙˆØ§Øª ØµØºÙŠØ±Ø©.
- Ù…ÙƒØ§ÙØ£Ø© Ø°Ø§ØªÙŠØ© Ø¨Ø¹Ø¯ ÙƒÙ„ Ø¥Ù†Ø¬Ø§Ø² Ø¨Ø³ÙŠØ·.

### ğŸŒ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 4-6: Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡
- ÙˆØ¶Ø¹ Ø£Ù‡Ø¯Ø§Ù Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© Ù‚ØµÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ù‰.
- Ù…Ù…Ø§Ø±Ø³Ø© Ù†Ø´Ø§Ø· Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ Ø¨Ø³ÙŠØ·.
- Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø³Ù„Ø¨ÙŠØ© ÙˆØ¥Ø¹Ø§Ø¯Ø© ØµÙŠØ§ØºØªÙ‡Ø§.
âš ï¸ ÙŠÙÙ†ØµØ­ Ø¨Ø§Ø³ØªØ´Ø§Ø±Ø© Ù…Ø®ØªØµ Ø¥Ø°Ø§ Ø§Ø³ØªÙ…Ø±Øª Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶.
"""

    # =========================
    # 3ï¸âƒ£ Ø§Ø®ØªÙ„Ø§Ù„ ØºÙŠØ± Ù…ØªÙˆØ§Ø²Ù†
    # =========================
    elif profile == "Ø§Ø®ØªÙ„Ø§Ù„ ØºÙŠØ± Ù…ØªÙˆØ§Ø²Ù†":
        weakest = labels[np.argmin(scores)]
        report += f"""
### ğŸ¯ ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø¨ÙØ¹Ø¯: {weakest}

Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1-2:
- ØªÙ†ÙÙŠØ° ØªÙ…Ø§Ø±ÙŠÙ† Ù…Ø®ØµØµØ© Ù„ØªØ­Ø³ÙŠÙ† Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø§Ù†Ø¨.
- Ù‚ÙŠØ§Ø³ Ø§Ù„ØªØ­Ø³Ù† Ù†Ù‡Ø§ÙŠØ© ÙƒÙ„ Ø£Ø³Ø¨ÙˆØ¹.

Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 3-4:
- Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ¹Ø±Ø¶ Ù„Ù…ÙˆØ§Ù‚Ù ØªØ¹Ø²Ø² Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø¹Ø¯.
- ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¶ØºØ· ÙÙŠ Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨.

Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 5-6:
- ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ­Ø³Ù† Ø§Ù„Ù…ÙƒØªØ³Ø¨.
- ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©.
"""

    # =========================
    # 4ï¸âƒ£ Ø¶Ø¹Ù ÙÙŠ Ø§Ù„Ù…Ø¹Ù†Ù‰
    # =========================
    elif profile == "Ø¶Ø¹Ù ÙÙŠ Ø§Ù„Ù…Ø¹Ù†Ù‰":
        report += """
### ğŸŒ± Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¹Ù†Ù‰ ÙˆØ§Ù„Ù‡Ø¯Ù

Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1:
- ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø´Ø®ØµÙŠØ©.
- ØªØ­Ø¯ÙŠØ¯ Ù…Ø§ Ù‡Ùˆ Ù…Ù‡Ù… ÙØ¹Ù„Ø§Ù‹ Ù„Ùƒ.

Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 2-3:
- Ø§Ø®ØªÙŠØ§Ø± Ù‡Ø¯Ù ØµØºÙŠØ± Ù…Ø±ØªØ¨Ø· Ø¨Ù‚ÙŠÙ…Ùƒ.
- Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„ÙŠÙ‡ 20 Ø¯Ù‚ÙŠÙ‚Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹.

Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 4-6:
- ØªØ¬Ø±Ø¨Ø© Ù†Ø´Ø§Ø· Ø¬Ø¯ÙŠØ¯ (ØªØ·ÙˆØ¹ÙŠ Ø£Ùˆ Ù…Ù‡Ø§Ø±ÙŠ).
- Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªÙ‚Ø¯Ù… ÙˆØªØ­Ø¯ÙŠØ¯ Ù‡Ø¯Ù Ø£ÙƒØ¨Ø±.
"""

    # =========================
    # 5ï¸âƒ£ Ø§Ù†Ø®ÙØ§Ø¶ Ù…Ø²Ø§Ø¬ÙŠ
    # =========================
    elif profile == "Ø§Ù†Ø®ÙØ§Ø¶ Ù…Ø²Ø§Ø¬ÙŠ":
        report += """
### ğŸŒ¤ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø²Ø§Ø¬

Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1:
- ØªÙ…Ø±ÙŠÙ† Ø§Ù„Ø§Ù…ØªÙ†Ø§Ù† (3 Ø£Ø´ÙŠØ§Ø¡ ÙŠÙˆÙ…ÙŠØ§Ù‹).
- Ø§Ù„ØªØ¹Ø±Ø¶ Ù„Ù„Ø´Ù…Ø³ 15 Ø¯Ù‚ÙŠÙ‚Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹.

Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 2-3:
- Ù†Ø´Ø§Ø· Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ Ø¨Ø³ÙŠØ· Ù…Ø±Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹.
- ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø³Ù„Ø¨ÙŠØ© ÙˆØ¥Ø¹Ø§Ø¯Ø© ØµÙŠØ§ØºØªÙ‡Ø§.

Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 4-6:
- Ø¥Ø¯Ø®Ø§Ù„ Ù†Ø´Ø§Ø· Ø±ÙŠØ§Ø¶ÙŠ Ù…Ù†ØªØ¸Ù….
- ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªØ­Ø³Ù† Ø§Ù„Ù…Ø²Ø§Ø¬ÙŠ Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹.
"""

    # =========================
    # 6ï¸âƒ£ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ù†Ø³Ø¨ÙŠ
    # =========================
    else:
        report += """
### ğŸŒ¿ Ø®Ø·Ø© Ø§Ø³ØªØ¯Ø§Ù…Ø©

Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1-2:
- Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©.
- ØªØ­Ø³ÙŠÙ† Ø¬ÙˆØ¯Ø© Ø§Ù„Ù†ÙˆÙ… ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹.

Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 3-4:
- Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø· ØªØ·ÙˆÙŠØ± Ø°Ø§ØªÙŠ.
- Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£Ù‡Ø¯Ø§ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©.

Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 5-6:
- ØªØ«Ø¨ÙŠØª Ø£ÙØ¶Ù„ Ø¹Ø§Ø¯Ø© Ø§ÙƒØªØ³Ø¨ØªÙ‡Ø§.
- ÙˆØ¶Ø¹ Ø®Ø·Ø© Ø´Ù‡Ø±ÙŠØ© Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©.
"""

    report += "\n\n> Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø£Ø¯Ø§Ø© Ø¯Ø¹Ù… Ø°Ø§ØªÙŠ ÙˆÙ„Ø§ ÙŠÙØ¹Ø¯ ØªØ´Ø®ÙŠØµØ§Ù‹ Ø·Ø¨ÙŠØ§Ù‹."

    return report


# =====================================
# ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
# =====================================

st.title("ğŸ§  ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø±ÙØ§Ù‡ÙŠØ© Ø§Ù„Ù†ÙØ³ÙŠØ© WHO-5")

st.markdown("""
Ø£Ø¬Ø¨ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¢Ø®Ø± Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†.
0 = Ø£Ø¨Ø¯Ø§Ù‹ | 5 = Ø·ÙˆØ§Ù„ Ø§Ù„ÙˆÙ‚Øª
""")

q1 = st.slider("Ø´Ø¹Ø±Øª Ø¨Ù…Ø²Ø§Ø¬ Ø¬ÙŠØ¯", 0, 5, 2)
q2 = st.slider("Ø´Ø¹Ø±Øª Ø¨Ø§Ù„Ù‡Ø¯ÙˆØ¡ ÙˆØ§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡", 0, 5, 2)
q3 = st.slider("Ø´Ø¹Ø±Øª Ø¨Ø§Ù„Ù†Ø´Ø§Ø· ÙˆØ§Ù„Ø­ÙŠÙˆÙŠØ©", 0, 5, 2)
q4 = st.slider("Ø§Ø³ØªÙŠÙ‚Ø¸Øª Ù†Ø´ÙŠØ·Ø§Ù‹ ÙˆÙ…Ù†ØªØ¹Ø´Ø§Ù‹", 0, 5, 2)
q5 = st.slider("ÙƒØ§Ù† Ù„Ø­ÙŠØ§ØªÙŠ Ù…Ø¹Ù†Ù‰", 0, 5, 2)

sleep = st.slider("Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†ÙˆÙ…", 4, 10, 7)
activity = st.slider("Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¨Ø¯Ù†ÙŠ", 1, 5, 3)

if st.button("Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©"):

    user_input = np.array([[q1, q2, q3, q4, q5, sleep, activity]])
    prediction = model.predict(user_input)[0]

    if prediction == 2:
        status = "ğŸ”´ Ø®Ø·Ø±"
    elif prediction == 1:
        status = "ğŸŸ¡ Ù…ØªÙˆØ³Ø·"
    else:
        status = "ğŸŸ¢ Ø·Ø¨ÙŠØ¹ÙŠ"

    st.subheader("ğŸ“Œ ØªØµÙ†ÙŠÙ Ø§Ù„Ø­Ø§Ù„Ø©:")
    st.markdown(f"## {status}")
    st.divider()

    report = generate_plan(q1, q2, q3, q4, q5, sleep, activity)
    st.markdown(report)
